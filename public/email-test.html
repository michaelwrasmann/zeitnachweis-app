<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Test - Zeitnachweis-System</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <nav>
        <div class="nav-container">
            <h1>üìä Zeitnachweis-System</h1>
            <div class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/upload.html">Upload</a>
                <a href="/admin.html">Admin</a>
                <a href="/email-test.html" class="active">Email Test</a>
            </div>
        </div>
    </nav>

    <main>
        <div class="container">
            <h2>Email System Test</h2>
            <p>Teste die Email-Konfiguration des Zeitnachweis-Systems</p>
            
            <div id="emailStatus" class="alert-container"></div>
            
            <div class="email-test-section">
                <div style="text-align: center; padding: 40px;">
                    
                    <!-- Email Icon -->
                    <div style="margin-bottom: 30px;">
                        <svg width="80" height="80" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin: 0 auto; color: #3498db;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                        </svg>
                    </div>

                    <!-- Description -->
                    <div style="margin-bottom: 30px;">
                        <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 15px; color: #2c3e50;">Email-System Test</h3>
                        <p style="color: #666; font-size: 1rem; line-height: 1.5; max-width: 500px; margin: 0 auto;">
                            Klicken Sie auf den Button um eine Test-Email zu versenden und die SMTP-Konfiguration zu pr√ºfen. 
                            Die Email wird an <strong>michael.wrasmann@dlr.de</strong> gesendet.
                        </p>
                    </div>

                    <!-- Test Button -->
                    <div style="margin-bottom: 30px;">
                        <button class="btn btn-primary" id="send-test-email" style="padding: 15px 30px; font-size: 1.1rem;">
                            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            Test-Email senden
                        </button>
                    </div>

                    <!-- Status Area -->
                    <div id="email-result" style="display: none; margin-bottom: 30px;">
                        <!-- Status wird hier angezeigt -->
                    </div>

                    <!-- Back Button -->
                    <div>
                        <a href="/" class="btn btn-secondary">
                            <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 8px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            Zur√ºck zum Dashboard
                        </a>
                    </div>

                </div>
            </div>
            
            <!-- Info Panel -->
            <div class="info-panel">
                <h4>‚ÑπÔ∏è Technische Informationen</h4>
                <div class="info-grid">
                    <strong>SMTP Server:</strong>
                    <span>smtp.dlr.de:587</span>
                    
                    <strong>Absender:</strong>
                    <span>f_weasel (weasel@dlr.de)</span>
                    
                    <strong>Empf√§nger:</strong>
                    <span>michael.wrasmann@dlr.de</span>
                    
                    <strong>Verschl√ºsselung:</strong>
                    <span>STARTTLS</span>
                    
                    <strong>Aktuelle Zeit:</strong>
                    <span id="current-time">--:--</span>
                </div>
            </div>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üìß Email-Test Seite wird initialisiert...');
            
            // Setup Email Test Button
            const sendTestEmailBtn = document.getElementById('send-test-email');
            if (sendTestEmailBtn) {
                sendTestEmailBtn.addEventListener('click', sendTestEmail);
            }
            
            // Zeit aktualisieren
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            console.log('‚úÖ Email-Test Seite erfolgreich initialisiert');
        });

        async function sendTestEmail() {
            const button = document.getElementById('send-test-email');
            const resultDiv = document.getElementById('email-result');
            
            // Button auf "Senden..." setzen
            const originalContent = button.innerHTML;
            button.innerHTML = `
                <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" style="margin-right: 8px; animation: spin 1s linear infinite;">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Email wird gesendet...
            `;
            button.disabled = true;
            
            try {
                console.log('üìß Sende Test-Email...');
                
                const response = await fetch('/api/send-test-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // Erfolg
                    resultDiv.innerHTML = `
                        <div style="background: #D1FAE5; border: 1px solid #10B981; border-radius: 8px; padding: 20px; text-align: left;">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <svg width="24" height="24" fill="none" stroke="#10B981" viewBox="0 0 24 24" style="margin-right: 8px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                </svg>
                                <strong style="color: #047857;">Email erfolgreich versendet!</strong>
                            </div>
                            <p style="color: #065F46; margin: 0; font-size: 0.9rem;">
                                Die Test-Email wurde erfolgreich an <strong>michael.wrasmann@dlr.de</strong> gesendet. 
                                Bitte pr√ºfen Sie Ihr Postfach (auch den Spam-Ordner).
                            </p>
                            ${result.messageId ? `<p style="color: #065F46; margin: 8px 0 0 0; font-size: 0.8rem;">Message-ID: ${result.messageId}</p>` : ''}
                        </div>
                    `;
                    console.log('‚úÖ Test-Email erfolgreich versendet');
                    
                } else {
                    // Fehler
                    resultDiv.innerHTML = `
                        <div style="background: #FEF2F2; border: 1px solid #EF4444; border-radius: 8px; padding: 20px; text-align: left;">
                            <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                <svg width="24" height="24" fill="none" stroke="#EF4444" viewBox="0 0 24 24" style="margin-right: 8px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                <strong style="color: #DC2626;">Fehler beim Email-Versand</strong>
                            </div>
                            <p style="color: #991B1B; margin: 0; font-size: 0.9rem;">
                                <strong>Grund:</strong> ${result.error || 'Unbekannter Fehler'}
                            </p>
                            ${result.details ? `<p style="color: #991B1B; margin: 8px 0 0 0; font-size: 0.8rem;"><strong>Details:</strong> ${result.details}</p>` : ''}
                        </div>
                    `;
                    console.error('‚ùå Email-Versand fehlgeschlagen:', result.error);
                }
                
            } catch (error) {
                // Netzwerk-/JavaScript-Fehler
                resultDiv.innerHTML = `
                    <div style="background: #FEF2F2; border: 1px solid #EF4444; border-radius: 8px; padding: 20px; text-align: left;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <svg width="24" height="24" fill="none" stroke="#EF4444" viewBox="0 0 24 24" style="margin-right: 8px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                            <strong style="color: #DC2626;">Verbindungsfehler</strong>
                        </div>
                        <p style="color: #991B1B; margin: 0; font-size: 0.9rem;">
                            Fehler beim Verbinden mit dem Server. Bitte versuchen Sie es sp√§ter erneut.
                        </p>
                        <p style="color: #991B1B; margin: 8px 0 0 0; font-size: 0.8rem;">
                            <strong>Technischer Fehler:</strong> ${error.message}
                        </p>
                    </div>
                `;
                console.error('‚ùå Verbindungsfehler:', error);
            }
            
            // Button zur√ºcksetzen
            button.innerHTML = originalContent;
            button.disabled = false;
            
            // Status anzeigen
            resultDiv.style.display = 'block';
        }

        // Aktuelle Zeit anzeigen
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('de-DE', { 
                hour: '2-digit', 
                minute: '2-digit', 
                second: '2-digit' 
            });
            
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = timeString;
            }
        }
    </script>

    <style>
        /* Spinner Animation f√ºr Loading Button */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .email-test-section {
            background: #f8f9fa;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .info-panel {
            background: #fff;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 10px 20px;
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</body>
</html>